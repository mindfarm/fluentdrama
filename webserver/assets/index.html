<! DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Fluent Drama</title>
		<script src="vue.js"></script>
	</head>
	<body>
		<div id="banner" style="border: thin solid red">
		All data published in accordance with Article 9, Paragraph 2, point (e)
		of the GDPR. For further information please read 
		<a href="https://gdpr-info.eu/art-9-gdpr/">Article 9</a>.
		</div>
		<div id="channels" style="width: 10em; border: thin solid red">
			<div  v-for="chans in channelList">
				<ul style="list-style: none;">
					<li v-for="chan in chans" v-on:click="gLogs(chan)">{{ chan }}</li>
				</ul>
			</div>
		</div>
		<div id="logs">
			<div v-for="logd in logList">
			<div v-for="l in logd" :key="l.Time">
				<div class="logdata" v-bind:id="logd.stamp" style="display: contents">
					<span class="when" style="display: inline-block; max-width: max-content">{{String(l.Time).split(".")[0].split(" ")[1] }}</span>
					<span class="who" style="display: inline-block; max-width: max-content">&lt; {{ l.Nick}} &gt;</span>
					<span class="what">{{ l.Said }}</span>
				</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var vue = new Vue({
				el: '#channels',
				data () {
					return {
						channelList: []
					}
				},
				methods: {
					gLogs(channelName){
						logs.getLogs(channelName)
					}
				},
				mounted() {
					fetch('/channels')
						.then(response => response.json())
						.then(data => (this.channelList = data));
				}
			})
			var logs = new Vue ({
				el: '#logs',
				data () {
					return {
						logList: []
					}
				},
				methods: {
					getLogs(channelName) {
					cName = encodeURIComponent(channelName)
					fetch('/logs/'+cName+'/')
						.then(response => response.json())
						.then(data => (this.logList = data));
					}
				},
				mounted: function() {
					this.getLogs('#go-nuts')
				}
			})
		</script>
	</body>
</html>
